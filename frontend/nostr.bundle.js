"use strict";var NostrTools=(()=>{var Zt=Object.defineProperty;var ko=Object.getOwnPropertyDescriptor;var Lo=Object.getOwnPropertyNames;var Io=Object.prototype.hasOwnProperty;var V=(t,e)=>{for(var n in e)Zt(t,n,{get:e[n],enumerable:!0})},Oo=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Lo(e))!Io.call(t,o)&&o!==n&&Zt(t,o,{get:()=>e[o],enumerable:!(r=ko(e,o))||r.enumerable});return t};var Co=t=>Oo(Zt({},"__esModule",{value:!0}),t);var ga={};V(ga,{AbstractRelay:()=>be,AbstractSimplePool:()=>it,Relay:()=>Je,SimplePool:()=>Cn,Subscription:()=>$t,finalizeEvent:()=>se,fj:()=>Ln,generateSecretKey:()=>Li,getEventHash:()=>Ge,getFilterLimit:()=>Ks,getPublicKey:()=>Ii,kinds:()=>Rn,matchFilter:()=>Yr,matchFilters:()=>Pn,mergeFilters:()=>Ws,nip04:()=>zn,nip05:()=>Wn,nip10:()=>Kn,nip11:()=>Zn,nip13:()=>Gn,nip18:()=>Jn,nip19:()=>Dn,nip21:()=>Yn,nip25:()=>Xn,nip27:()=>Fn,nip28:()=>er,nip30:()=>nr,nip39:()=>or,nip42:()=>On,nip44:()=>lr,nip47:()=>ur,nip57:()=>hr,nip98:()=>gr,parseReferences:()=>pc,relayConnect:()=>Ys,serializeEvent:()=>Kr,utils:()=>wn,validateEvent:()=>nt,verifiedSymbol:()=>ye,verifyEvent:()=>he});function br(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Gt(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function wr(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");br(t.outputLen),br(t.blockLen)}function je(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Er(t,e){Gt(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var lt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var vr=t=>t instanceof Uint8Array;var ut=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),le=(t,e)=>t<<32-e|t>>>e,No=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!No)throw new Error("Non little-endian hardware is not supported");function $o(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Fe(t){if(typeof t=="string"&&(t=$o(t)),!vr(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Ar(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!vr(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}var ze=class{clone(){return this._cloneInto()}},va={}.toString;function Br(t){let e=r=>t().update(Fe(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function dt(t=32){if(lt&&typeof lt.getRandomValues=="function")return lt.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Ho(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,f=r?0:4;t.setUint32(e+a,s,r),t.setUint32(e+f,c,r)}var ht=class extends ze{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ut(this.buffer)}update(e){je(this);let{view:n,buffer:r,blockLen:o}=this;e=Fe(e);let i=e.length;for(let s=0;s<i;){let c=Math.min(o-this.pos,i-s);if(c===o){let a=ut(e);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(e.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){je(this),Er(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:i}=this,{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let l=s;l<o;l++)n[l]=0;Ho(r,o-8,BigInt(this.length*8),i),this.process(r,0);let c=ut(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=a/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)c.setUint32(4*l,u[l],i)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return e.length=o,e.pos=c,e.finished=i,e.destroyed=s,o%n&&e.buffer.set(r),e}};var qo=(t,e,n)=>t&e^~t&n,Mo=(t,e,n)=>t&e^t&n^e&n,Vo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Be=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Te=new Uint32Array(64),Jt=class extends ht{constructor(){super(64,32,8,!1),this.A=Be[0]|0,this.B=Be[1]|0,this.C=Be[2]|0,this.D=Be[3]|0,this.E=Be[4]|0,this.F=Be[5]|0,this.G=Be[6]|0,this.H=Be[7]|0}get(){let{A:e,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[e,n,r,o,i,s,c,a]}set(e,n,r,o,i,s,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=a|0}process(e,n){for(let l=0;l<16;l++,n+=4)Te[l]=e.getUint32(n,!1);for(let l=16;l<64;l++){let p=Te[l-15],x=Te[l-2],m=le(p,7)^le(p,18)^p>>>3,d=le(x,17)^le(x,19)^x>>>10;Te[l]=d+Te[l-7]+m+Te[l-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:f,H:u}=this;for(let l=0;l<64;l++){let p=le(c,6)^le(c,11)^le(c,25),x=u+p+qo(c,a,f)+Vo[l]+Te[l]|0,d=(le(r,2)^le(r,13)^le(r,22))+Mo(r,o,i)|0;u=f,f=a,a=c,c=s+x|0,s=i,i=o,o=r,r=x+d|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(r,o,i,s,c,a,f,u)}roundClean(){Te.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var pt=Br(()=>new Jt);var Ft={};V(Ft,{bitGet:()=>Go,bitLen:()=>Zo,bitMask:()=>et,bitSet:()=>Jo,bytesToHex:()=>Ne,bytesToNumberBE:()=>G,bytesToNumberLE:()=>xt,concatBytes:()=>xe,createHmacDrbg:()=>Qt,ensureBytes:()=>j,equalBytes:()=>Wo,hexToBytes:()=>$e,hexToNumber:()=>Xt,numberToBytesBE:()=>ue,numberToBytesLE:()=>mt,numberToHexUnpadded:()=>Sr,numberToVarBytesBE:()=>zo,utf8ToBytes:()=>Ko,validateObject:()=>Ue});var Ur=BigInt(0),gt=BigInt(1),Do=BigInt(2),yt=t=>t instanceof Uint8Array,jo=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ne(t){if(!yt(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=jo[t[n]];return e}function Sr(t){let e=t.toString(16);return e.length&1?`0${e}`:e}function Xt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function $e(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){let o=r*2,i=t.slice(o,o+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[r]=s}return n}function G(t){return Xt(Ne(t))}function xt(t){if(!yt(t))throw new Error("Uint8Array expected");return Xt(Ne(Uint8Array.from(t).reverse()))}function ue(t,e){return $e(t.toString(16).padStart(e*2,"0"))}function mt(t,e){return ue(t,e).reverse()}function zo(t){return $e(Sr(t))}function j(t,e,n){let r;if(typeof e=="string")try{r=$e(e)}catch(i){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${i}`)}else if(yt(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);let o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${t} expected ${n} bytes, got ${o}`);return r}function xe(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!yt(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function Wo(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Ko(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Zo(t){let e;for(e=0;t>Ur;t>>=gt,e+=1);return e}function Go(t,e){return t>>BigInt(e)&gt}var Jo=(t,e,n)=>t|(n?gt:Ur)<<BigInt(e),et=t=>(Do<<BigInt(t-1))-gt,Yt=t=>new Uint8Array(t),Tr=t=>Uint8Array.from(t);function Qt(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Yt(t),o=Yt(t),i=0,s=()=>{r.fill(1),o.fill(0),i=0},c=(...l)=>n(o,r,...l),a=(l=Yt())=>{o=c(Tr([0]),l),r=c(),l.length!==0&&(o=c(Tr([1]),l),r=c())},f=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let l=0,p=[];for(;l<e;){r=c();let x=r.slice();p.push(x),l+=r.length}return xe(...p)};return(l,p)=>{s(),a(l);let x;for(;!(x=p(f()));)a();return s(),x}}var Yo={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ue(t,e,n={}){let r=(o,i,s)=>{let c=Yo[i];if(typeof c!="function")throw new Error(`Invalid validator "${i}", expected function`);let a=t[o];if(!(s&&a===void 0)&&!c(a,t))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${i}`)};for(let[o,i]of Object.entries(e))r(o,i,!1);for(let[o,i]of Object.entries(n))r(o,i,!0);return t}var W=BigInt(0),D=BigInt(1),He=BigInt(2),Xo=BigInt(3),en=BigInt(4),_r=BigInt(5),Rr=BigInt(8),Qo=BigInt(9),Fo=BigInt(16);function z(t,e){let n=t%e;return n>=W?n:e+n}function ei(t,e,n){if(n<=W||e<W)throw new Error("Expected power/modulo > 0");if(n===D)return W;let r=D;for(;e>W;)e&D&&(r=r*t%n),t=t*t%n,e>>=D;return r}function re(t,e,n){let r=t;for(;e-- >W;)r*=r,r%=n;return r}function bt(t,e){if(t===W||e<=W)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=z(t,e),r=e,o=W,i=D,s=D,c=W;for(;n!==W;){let f=r/n,u=r%n,l=o-s*f,p=i-c*f;r=n,n=u,o=s,i=c,s=l,c=p}if(r!==D)throw new Error("invert: does not exist");return z(o,e)}function ti(t){let e=(t-D)/He,n,r,o;for(n=t-D,r=0;n%He===W;n/=He,r++);for(o=He;o<t&&ei(o,e,t)!==t-D;o++);if(r===1){let s=(t+D)/en;return function(a,f){let u=a.pow(f,s);if(!a.eql(a.sqr(u),f))throw new Error("Cannot find square root");return u}}let i=(n+D)/He;return function(c,a){if(c.pow(a,e)===c.neg(c.ONE))throw new Error("Cannot find square root");let f=r,u=c.pow(c.mul(c.ONE,o),n),l=c.pow(a,i),p=c.pow(a,n);for(;!c.eql(p,c.ONE);){if(c.eql(p,c.ZERO))return c.ZERO;let x=1;for(let d=c.sqr(p);x<f&&!c.eql(d,c.ONE);x++)d=c.sqr(d);let m=c.pow(u,D<<BigInt(f-x-1));u=c.sqr(m),l=c.mul(l,m),p=c.mul(p,u),f=x}return l}}function ni(t){if(t%en===Xo){let e=(t+D)/en;return function(r,o){let i=r.pow(o,e);if(!r.eql(r.sqr(i),o))throw new Error("Cannot find square root");return i}}if(t%Rr===_r){let e=(t-_r)/Rr;return function(r,o){let i=r.mul(o,He),s=r.pow(i,e),c=r.mul(o,s),a=r.mul(r.mul(c,He),s),f=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(f),o))throw new Error("Cannot find square root");return f}}return t%Fo,ti(t)}var ri=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function tn(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=ri.reduce((r,o)=>(r[o]="function",r),e);return Ue(t,n)}function oi(t,e,n){if(n<W)throw new Error("Expected power > 0");if(n===W)return t.ONE;if(n===D)return e;let r=t.ONE,o=e;for(;n>W;)n&D&&(r=t.mul(r,o)),o=t.sqr(o),n>>=D;return r}function ii(t,e){let n=new Array(e.length),r=e.reduce((i,s,c)=>t.is0(s)?i:(n[c]=i,t.mul(i,s)),t.ONE),o=t.inv(r);return e.reduceRight((i,s,c)=>t.is0(s)?i:(n[c]=t.mul(i,n[c]),t.mul(i,s)),o),n}function nn(t,e){let n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Pr(t,e,n=!1,r={}){if(t<=W)throw new Error(`Expected Field ORDER > 0, got ${t}`);let{nBitLength:o,nByteLength:i}=nn(t,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");let s=ni(t),c=Object.freeze({ORDER:t,BITS:o,BYTES:i,MASK:et(o),ZERO:W,ONE:D,create:a=>z(a,t),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return W<=a&&a<t},is0:a=>a===W,isOdd:a=>(a&D)===D,neg:a=>z(-a,t),eql:(a,f)=>a===f,sqr:a=>z(a*a,t),add:(a,f)=>z(a+f,t),sub:(a,f)=>z(a-f,t),mul:(a,f)=>z(a*f,t),pow:(a,f)=>oi(c,a,f),div:(a,f)=>z(a*bt(f,t),t),sqrN:a=>a*a,addN:(a,f)=>a+f,subN:(a,f)=>a-f,mulN:(a,f)=>a*f,inv:a=>bt(a,t),sqrt:r.sqrt||(a=>s(c,a)),invertBatch:a=>ii(c,a),cmov:(a,f,u)=>u?f:a,toBytes:a=>n?mt(a,i):ue(a,i),fromBytes:a=>{if(a.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${a.length}`);return n?xt(a):G(a)}});return Object.freeze(c)}function kr(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function rn(t){let e=kr(t);return e+Math.ceil(e/2)}function Lr(t,e,n=!1){let r=t.length,o=kr(e),i=rn(e);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);let s=n?G(t):xt(t),c=z(s,e-D)+D;return n?mt(c,o):ue(c,o)}var ci=BigInt(0),on=BigInt(1);function Ir(t,e){let n=(o,i)=>{let s=i.negate();return o?s:i},r=o=>{let i=Math.ceil(e/o)+1,s=2**(o-1);return{windows:i,windowSize:s}};return{constTimeNegate:n,unsafeLadder(o,i){let s=t.ZERO,c=o;for(;i>ci;)i&on&&(s=s.add(c)),c=c.double(),i>>=on;return s},precomputeWindow(o,i){let{windows:s,windowSize:c}=r(i),a=[],f=o,u=f;for(let l=0;l<s;l++){u=f,a.push(u);for(let p=1;p<c;p++)u=u.add(f),a.push(u);f=u.double()}return a},wNAF(o,i,s){let{windows:c,windowSize:a}=r(o),f=t.ZERO,u=t.BASE,l=BigInt(2**o-1),p=2**o,x=BigInt(o);for(let m=0;m<c;m++){let d=m*a,g=Number(s&l);s>>=x,g>a&&(g-=p,s+=on);let w=d,R=d+Math.abs(g)-1,P=m%2!==0,N=g<0;g===0?u=u.add(n(P,i[w])):f=f.add(n(N,i[R]))}return{p:f,f:u}},wNAFCached(o,i,s,c){let a=o._WINDOW_SIZE||1,f=i.get(o);return f||(f=this.precomputeWindow(o,a),a!==1&&i.set(o,c(f))),this.wNAF(a,f,s)}}}function sn(t){return tn(t.Fp),Ue(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nn(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function ai(t){let e=sn(t);Ue(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}var{bytesToNumberBE:fi,hexToBytes:li}=Ft,qe={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){let{Err:e}=qe;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");let n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:fi(r),l:t.subarray(n+2)}},toSig(t){let{Err:e}=qe,n=typeof t=="string"?li(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");let{d:o,l:i}=qe._parseInt(n.subarray(2)),{d:s,l:c}=qe._parseInt(i);if(c.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s}},hexFromSig(t){let e=f=>Number.parseInt(f[0],16)&8?"00"+f:f,n=f=>{let u=f.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),o=e(n(t.r)),i=r.length/2,s=o.length/2,c=n(i),a=n(s);return`30${n(s+i+4)}02${a}${o}02${c}${r}`}},me=BigInt(0),ae=BigInt(1),ja=BigInt(2),Or=BigInt(3),za=BigInt(4);function ui(t){let e=ai(t),{Fp:n}=e,r=e.toBytes||((m,d,g)=>{let w=d.toAffine();return xe(Uint8Array.from([4]),n.toBytes(w.x),n.toBytes(w.y))}),o=e.fromBytes||(m=>{let d=m.subarray(1),g=n.fromBytes(d.subarray(0,n.BYTES)),w=n.fromBytes(d.subarray(n.BYTES,2*n.BYTES));return{x:g,y:w}});function i(m){let{a:d,b:g}=e,w=n.sqr(m),R=n.mul(w,m);return n.add(n.add(R,n.mul(m,d)),g)}if(!n.eql(n.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function s(m){return typeof m=="bigint"&&me<m&&m<e.n}function c(m){if(!s(m))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(m){let{allowedPrivateKeyLengths:d,nByteLength:g,wrapPrivateKey:w,n:R}=e;if(d&&typeof m!="bigint"){if(m instanceof Uint8Array&&(m=Ne(m)),typeof m!="string"||!d.includes(m.length))throw new Error("Invalid key");m=m.padStart(g*2,"0")}let P;try{P=typeof m=="bigint"?m:G(j("private key",m,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof m}`)}return w&&(P=z(P,R)),c(P),P}let f=new Map;function u(m){if(!(m instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(d,g,w){if(this.px=d,this.py=g,this.pz=w,d==null||!n.isValid(d))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(w==null||!n.isValid(w))throw new Error("z required")}static fromAffine(d){let{x:g,y:w}=d||{};if(!d||!n.isValid(g)||!n.isValid(w))throw new Error("invalid affine point");if(d instanceof l)throw new Error("projective point not allowed");let R=P=>n.eql(P,n.ZERO);return R(g)&&R(w)?l.ZERO:new l(g,w,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){let g=n.invertBatch(d.map(w=>w.pz));return d.map((w,R)=>w.toAffine(g[R])).map(l.fromAffine)}static fromHex(d){let g=l.fromAffine(o(j("pointHex",d)));return g.assertValidity(),g}static fromPrivateKey(d){return l.BASE.multiply(a(d))}_setWindowSize(d){this._WINDOW_SIZE=d,f.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:d,y:g}=this.toAffine();if(!n.isValid(d)||!n.isValid(g))throw new Error("bad point: x or y not FE");let w=n.sqr(g),R=i(d);if(!n.eql(w,R))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:d}=this.toAffine();if(n.isOdd)return!n.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){u(d);let{px:g,py:w,pz:R}=this,{px:P,py:N,pz:O}=d,E=n.eql(n.mul(g,O),n.mul(P,R)),A=n.eql(n.mul(w,O),n.mul(N,R));return E&&A}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){let{a:d,b:g}=e,w=n.mul(g,Or),{px:R,py:P,pz:N}=this,O=n.ZERO,E=n.ZERO,A=n.ZERO,T=n.mul(R,R),S=n.mul(P,P),_=n.mul(N,N),B=n.mul(R,P);return B=n.add(B,B),A=n.mul(R,N),A=n.add(A,A),O=n.mul(d,A),E=n.mul(w,_),E=n.add(O,E),O=n.sub(S,E),E=n.add(S,E),E=n.mul(O,E),O=n.mul(B,O),A=n.mul(w,A),_=n.mul(d,_),B=n.sub(T,_),B=n.mul(d,B),B=n.add(B,A),A=n.add(T,T),T=n.add(A,T),T=n.add(T,_),T=n.mul(T,B),E=n.add(E,T),_=n.mul(P,N),_=n.add(_,_),T=n.mul(_,B),O=n.sub(O,T),A=n.mul(_,S),A=n.add(A,A),A=n.add(A,A),new l(O,E,A)}add(d){u(d);let{px:g,py:w,pz:R}=this,{px:P,py:N,pz:O}=d,E=n.ZERO,A=n.ZERO,T=n.ZERO,S=e.a,_=n.mul(e.b,Or),B=n.mul(g,P),L=n.mul(w,N),I=n.mul(R,O),q=n.add(g,w),h=n.add(P,N);q=n.mul(q,h),h=n.add(B,L),q=n.sub(q,h),h=n.add(g,R);let y=n.add(P,O);return h=n.mul(h,y),y=n.add(B,I),h=n.sub(h,y),y=n.add(w,R),E=n.add(N,O),y=n.mul(y,E),E=n.add(L,I),y=n.sub(y,E),T=n.mul(S,h),E=n.mul(_,I),T=n.add(E,T),E=n.sub(L,T),T=n.add(L,T),A=n.mul(E,T),L=n.add(B,B),L=n.add(L,B),I=n.mul(S,I),h=n.mul(_,h),L=n.add(L,I),I=n.sub(B,I),I=n.mul(S,I),h=n.add(h,I),B=n.mul(L,h),A=n.add(A,B),B=n.mul(y,h),E=n.mul(q,E),E=n.sub(E,B),B=n.mul(q,L),T=n.mul(y,T),T=n.add(T,B),new l(E,A,T)}subtract(d){return this.add(d.negate())}is0(){return this.equals(l.ZERO)}wNAF(d){return x.wNAFCached(this,f,d,g=>{let w=n.invertBatch(g.map(R=>R.pz));return g.map((R,P)=>R.toAffine(w[P])).map(l.fromAffine)})}multiplyUnsafe(d){let g=l.ZERO;if(d===me)return g;if(c(d),d===ae)return this;let{endo:w}=e;if(!w)return x.unsafeLadder(this,d);let{k1neg:R,k1:P,k2neg:N,k2:O}=w.splitScalar(d),E=g,A=g,T=this;for(;P>me||O>me;)P&ae&&(E=E.add(T)),O&ae&&(A=A.add(T)),T=T.double(),P>>=ae,O>>=ae;return R&&(E=E.negate()),N&&(A=A.negate()),A=new l(n.mul(A.px,w.beta),A.py,A.pz),E.add(A)}multiply(d){c(d);let g=d,w,R,{endo:P}=e;if(P){let{k1neg:N,k1:O,k2neg:E,k2:A}=P.splitScalar(g),{p:T,f:S}=this.wNAF(O),{p:_,f:B}=this.wNAF(A);T=x.constTimeNegate(N,T),_=x.constTimeNegate(E,_),_=new l(n.mul(_.px,P.beta),_.py,_.pz),w=T.add(_),R=S.add(B)}else{let{p:N,f:O}=this.wNAF(g);w=N,R=O}return l.normalizeZ([w,R])[0]}multiplyAndAddUnsafe(d,g,w){let R=l.BASE,P=(O,E)=>E===me||E===ae||!O.equals(R)?O.multiplyUnsafe(E):O.multiply(E),N=P(this,g).add(P(d,w));return N.is0()?void 0:N}toAffine(d){let{px:g,py:w,pz:R}=this,P=this.is0();d==null&&(d=P?n.ONE:n.inv(R));let N=n.mul(g,d),O=n.mul(w,d),E=n.mul(R,d);if(P)return{x:n.ZERO,y:n.ZERO};if(!n.eql(E,n.ONE))throw new Error("invZ was invalid");return{x:N,y:O}}isTorsionFree(){let{h:d,isTorsionFree:g}=e;if(d===ae)return!0;if(g)return g(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:d,clearCofactor:g}=e;return d===ae?this:g?g(l,this):this.multiplyUnsafe(e.h)}toRawBytes(d=!0){return this.assertValidity(),r(l,this,d)}toHex(d=!0){return Ne(this.toRawBytes(d))}}l.BASE=new l(e.Gx,e.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);let p=e.nBitLength,x=Ir(l,e.endo?Math.ceil(p/2):p);return{CURVE:e,ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:i,isWithinCurveOrder:s}}function di(t){let e=sn(t);return Ue(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Cr(t){let e=di(t),{Fp:n,n:r}=e,o=n.BYTES+1,i=2*n.BYTES+1;function s(h){return me<h&&h<n.ORDER}function c(h){return z(h,r)}function a(h){return bt(h,r)}let{ProjectivePoint:f,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:p}=ui({...e,toBytes(h,y,v){let k=y.toAffine(),b=n.toBytes(k.x),C=xe;return v?C(Uint8Array.from([y.hasEvenY()?2:3]),b):C(Uint8Array.from([4]),b,n.toBytes(k.y))},fromBytes(h){let y=h.length,v=h[0],k=h.subarray(1);if(y===o&&(v===2||v===3)){let b=G(k);if(!s(b))throw new Error("Point is not on curve");let C=l(b),H=n.sqrt(C),$=(H&ae)===ae;return(v&1)===1!==$&&(H=n.neg(H)),{x:b,y:H}}else if(y===i&&v===4){let b=n.fromBytes(k.subarray(0,n.BYTES)),C=n.fromBytes(k.subarray(n.BYTES,2*n.BYTES));return{x:b,y:C}}else throw new Error(`Point of length ${y} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}}),x=h=>Ne(ue(h,e.nByteLength));function m(h){let y=r>>ae;return h>y}function d(h){return m(h)?c(-h):h}let g=(h,y,v)=>G(h.slice(y,v));class w{constructor(y,v,k){this.r=y,this.s=v,this.recovery=k,this.assertValidity()}static fromCompact(y){let v=e.nByteLength;return y=j("compactSignature",y,v*2),new w(g(y,0,v),g(y,v,2*v))}static fromDER(y){let{r:v,s:k}=qe.toSig(j("DER",y));return new w(v,k)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(y){return new w(this.r,this.s,y)}recoverPublicKey(y){let{r:v,s:k,recovery:b}=this,C=A(j("msgHash",y));if(b==null||![0,1,2,3].includes(b))throw new Error("recovery id invalid");let H=b===2||b===3?v+e.n:v;if(H>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let $=b&1?"03":"02",K=f.fromHex($+x(H)),X=a(H),ne=c(-C*X),ce=c(k*X),Q=f.BASE.multiplyAndAddUnsafe(K,ne,ce);if(!Q)throw new Error("point at infinify");return Q.assertValidity(),Q}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return $e(this.toDERHex())}toDERHex(){return qe.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return $e(this.toCompactHex())}toCompactHex(){return x(this.r)+x(this.s)}}let R={isValidPrivateKey(h){try{return u(h),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let h=rn(e.n);return Lr(e.randomBytes(h),e.n)},precompute(h=8,y=f.BASE){return y._setWindowSize(h),y.multiply(BigInt(3)),y}};function P(h,y=!0){return f.fromPrivateKey(h).toRawBytes(y)}function N(h){let y=h instanceof Uint8Array,v=typeof h=="string",k=(y||v)&&h.length;return y?k===o||k===i:v?k===2*o||k===2*i:h instanceof f}function O(h,y,v=!0){if(N(h))throw new Error("first arg must be private key");if(!N(y))throw new Error("second arg must be public key");return f.fromHex(y).multiply(u(h)).toRawBytes(v)}let E=e.bits2int||function(h){let y=G(h),v=h.length*8-e.nBitLength;return v>0?y>>BigInt(v):y},A=e.bits2int_modN||function(h){return c(E(h))},T=et(e.nBitLength);function S(h){if(typeof h!="bigint")throw new Error("bigint expected");if(!(me<=h&&h<T))throw new Error(`bigint expected < 2^${e.nBitLength}`);return ue(h,e.nByteLength)}function _(h,y,v=B){if(["recovered","canonical"].some(ee=>ee in v))throw new Error("sign() legacy options not supported");let{hash:k,randomBytes:b}=e,{lowS:C,prehash:H,extraEntropy:$}=v;C==null&&(C=!0),h=j("msgHash",h),H&&(h=j("prehashed msgHash",k(h)));let K=A(h),X=u(y),ne=[S(X),S(K)];if($!=null){let ee=$===!0?b(n.BYTES):$;ne.push(j("extraEntropy",ee))}let ce=xe(...ne),Q=K;function pe(ee){let Ve=E(ee);if(!p(Ve))return;let yr=a(Ve),ge=f.BASE.multiply(Ve).toAffine(),De=c(ge.x);if(De===me)return;let ft=c(yr*c(Q+De*X));if(ft===me)return;let xr=(ge.x===De?0:2)|Number(ge.y&ae),mr=ft;return C&&m(ft)&&(mr=d(ft),xr^=1),new w(De,mr,xr)}return{seed:ce,k2sig:pe}}let B={lowS:e.lowS,prehash:!1},L={lowS:e.lowS,prehash:!1};function I(h,y,v=B){let{seed:k,k2sig:b}=_(h,y,v),C=e;return Qt(C.hash.outputLen,C.nByteLength,C.hmac)(k,b)}f.BASE._setWindowSize(8);function q(h,y,v,k=L){let b=h;if(y=j("msgHash",y),v=j("publicKey",v),"strict"in k)throw new Error("options.strict was renamed to lowS");let{lowS:C,prehash:H}=k,$,K;try{if(typeof b=="string"||b instanceof Uint8Array)try{$=w.fromDER(b)}catch(ge){if(!(ge instanceof qe.Err))throw ge;$=w.fromCompact(b)}else if(typeof b=="object"&&typeof b.r=="bigint"&&typeof b.s=="bigint"){let{r:ge,s:De}=b;$=new w(ge,De)}else throw new Error("PARSE");K=f.fromHex(v)}catch(ge){if(ge.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(C&&$.hasHighS())return!1;H&&(y=e.hash(y));let{r:X,s:ne}=$,ce=A(y),Q=a(ne),pe=c(ce*Q),ee=c(X*Q),Ve=f.BASE.multiplyAndAddUnsafe(K,pe,ee)?.toAffine();return Ve?c(Ve.x)===X:!1}return{CURVE:e,getPublicKey:P,getSharedSecret:O,sign:I,verify:q,ProjectivePoint:f,Signature:w,utils:R}}var wt=class extends ze{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,wr(e);let r=Fe(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?e.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(e){return je(this),this.iHash.update(e),this}digestInto(e){je(this),Gt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},cn=(t,e,n)=>new wt(t,e).update(n).digest();cn.create=(t,e)=>new wt(t,e);function hi(t){return{hash:t,hmac:(e,...n)=>cn(t,e,Ar(...n)),randomBytes:dt}}function Nr(t,e){let n=r=>Cr({...t,...hi(r)});return Object.freeze({...n(e),create:n})}var Bt=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Et=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),qr=BigInt(1),vt=BigInt(2),$r=(t,e)=>(t+e/vt)/e;function Mr(t){let e=Bt,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),c=BigInt(44),a=BigInt(88),f=t*t*t%e,u=f*f*t%e,l=re(u,n,e)*u%e,p=re(l,n,e)*u%e,x=re(p,vt,e)*f%e,m=re(x,o,e)*x%e,d=re(m,i,e)*m%e,g=re(d,c,e)*d%e,w=re(g,a,e)*g%e,R=re(w,c,e)*d%e,P=re(R,n,e)*u%e,N=re(P,s,e)*m%e,O=re(N,r,e)*f%e,E=re(O,vt,e);if(!fn.eql(fn.sqr(E),t))throw new Error("Cannot find square root");return E}var fn=Pr(Bt,void 0,void 0,{sqrt:Mr}),Se=Nr({a:BigInt(0),b:BigInt(7),Fp:fn,n:Et,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{let e=Et,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-qr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,s=BigInt("0x100000000000000000000000000000000"),c=$r(i*t,e),a=$r(-r*t,e),f=z(t-c*n-a*o,e),u=z(-c*r-a*i,e),l=f>s,p=u>s;if(l&&(f=e-f),p&&(u=e-u),f>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:l,k1:f,k2neg:p,k2:u}}}},pt),Tt=BigInt(0),Vr=t=>typeof t=="bigint"&&Tt<t&&t<Bt,pi=t=>typeof t=="bigint"&&Tt<t&&t<Et,Hr={};function At(t,...e){let n=Hr[t];if(n===void 0){let r=pt(Uint8Array.from(t,o=>o.charCodeAt(0)));n=xe(r,r),Hr[t]=n}return pt(xe(n,...e))}var dn=t=>t.toRawBytes(!0).slice(1),ln=t=>ue(t,32),an=t=>z(t,Bt),tt=t=>z(t,Et),hn=Se.ProjectivePoint,gi=(t,e,n)=>hn.BASE.multiplyAndAddUnsafe(t,e,n);function un(t){let e=Se.utils.normPrivateKeyToScalar(t),n=hn.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:tt(-e),bytes:dn(n)}}function Dr(t){if(!Vr(t))throw new Error("bad x: need 0 < x < p");let e=an(t*t),n=an(e*t+BigInt(7)),r=Mr(n);r%vt!==Tt&&(r=an(-r));let o=new hn(t,r,qr);return o.assertValidity(),o}function jr(...t){return tt(G(At("BIP0340/challenge",...t)))}function yi(t){return un(t).bytes}function xi(t,e,n=dt(32)){let r=j("message",t),{bytes:o,scalar:i}=un(e),s=j("auxRand",n,32),c=ln(i^G(At("BIP0340/aux",s))),a=At("BIP0340/nonce",c,o,r),f=tt(G(a));if(f===Tt)throw new Error("sign failed: k is zero");let{bytes:u,scalar:l}=un(f),p=jr(u,o,r),x=new Uint8Array(64);if(x.set(u,0),x.set(ln(tt(l+p*i)),32),!zr(x,r,o))throw new Error("sign: Invalid signature produced");return x}function zr(t,e,n){let r=j("signature",t,64),o=j("message",e),i=j("publicKey",n,32);try{let s=Dr(G(i)),c=G(r.subarray(0,32));if(!Vr(c))return!1;let a=G(r.subarray(32,64));if(!pi(a))return!1;let f=jr(ln(c),dn(s),o),u=gi(s,a,tt(-f));return!(!u||!u.hasEvenY()||u.toAffine().x!==c)}catch{return!1}}var We=(()=>({getPublicKey:yi,sign:xi,verify:zr,utils:{randomPrivateKey:Se.utils.randomPrivateKey,lift_x:Dr,pointToBytes:dn,numberToBytesBE:ue,bytesToNumberBE:G,taggedHash:At,mod:z}}))();var Ut=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var pn=t=>t instanceof Uint8Array;var St=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),de=(t,e)=>t<<32-e|t>>>e,mi=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!mi)throw new Error("Non little-endian hardware is not supported");var bi=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Z(t){if(!pn(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=bi[t[n]];return e}function Me(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){let o=r*2,i=t.slice(o,o+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[r]=s}return n}function gn(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function _e(t){if(typeof t=="string"&&(t=gn(t)),!pn(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Ze(...t){let e=new Uint8Array(t.reduce((r,o)=>r+o.length,0)),n=0;return t.forEach(r=>{if(!pn(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}var Ke=class{clone(){return this._cloneInto()}};function yn(t){let e=r=>t().update(_e(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function _t(t=32){if(Ut&&typeof Ut.getRandomValues=="function")return Ut.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}var ye=Symbol("verified"),wi=t=>t instanceof Object;function nt(t){if(!wi(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function xn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Ei(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function Wr(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function vi(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");xn(t.outputLen),xn(t.blockLen)}function Ai(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Bi(t,e){Wr(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Ti={number:xn,bool:Ei,bytes:Wr,hash:vi,exists:Ai,output:Bi},oe=Ti;function Ui(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,f=r?0:4;t.setUint32(e+a,s,r),t.setUint32(e+f,c,r)}var Rt=class extends Ke{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=St(this.buffer)}update(e){oe.exists(this);let{view:n,buffer:r,blockLen:o}=this;e=_e(e);let i=e.length;for(let s=0;s<i;){let c=Math.min(o-this.pos,i-s);if(c===o){let a=St(e);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(e.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){oe.exists(this),oe.output(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:i}=this,{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let l=s;l<o;l++)n[l]=0;Ui(r,o-8,BigInt(this.length*8),i),this.process(r,0);let c=St(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=a/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)c.setUint32(4*l,u[l],i)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return e.length=o,e.pos=c,e.finished=i,e.destroyed=s,o%n&&e.buffer.set(r),e}};var Si=(t,e,n)=>t&e^~t&n,_i=(t,e,n)=>t&e^t&n^e&n,Ri=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Re=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Pe=new Uint32Array(64),Pt=class extends Rt{constructor(){super(64,32,8,!1),this.A=Re[0]|0,this.B=Re[1]|0,this.C=Re[2]|0,this.D=Re[3]|0,this.E=Re[4]|0,this.F=Re[5]|0,this.G=Re[6]|0,this.H=Re[7]|0}get(){let{A:e,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[e,n,r,o,i,s,c,a]}set(e,n,r,o,i,s,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=a|0}process(e,n){for(let l=0;l<16;l++,n+=4)Pe[l]=e.getUint32(n,!1);for(let l=16;l<64;l++){let p=Pe[l-15],x=Pe[l-2],m=de(p,7)^de(p,18)^p>>>3,d=de(x,17)^de(x,19)^x>>>10;Pe[l]=d+Pe[l-7]+m+Pe[l-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:f,H:u}=this;for(let l=0;l<64;l++){let p=de(c,6)^de(c,11)^de(c,25),x=u+p+Si(c,a,f)+Ri[l]+Pe[l]|0,d=(de(r,2)^de(r,13)^de(r,22))+_i(r,o,i)|0;u=f,f=a,a=c,c=s+x|0,s=i,i=o,o=r,r=x+d|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(r,o,i,s,c,a,f,u)}roundClean(){Pe.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},mn=class extends Pt{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},ke=yn(()=>new Pt),Tf=yn(()=>new mn);var wn={};V(wn,{Queue:()=>rt,QueueNode:()=>kt,binarySearch:()=>bn,insertEventIntoAscendingList:()=>ki,insertEventIntoDescendingList:()=>Pi,normalizeURL:()=>Le,utf8Decoder:()=>ie,utf8Encoder:()=>te});var ie=new TextDecoder("utf-8"),te=new TextEncoder;function Le(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function Pi(t,e){let[n,r]=bn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:o.created_at-e.created_at);return r||t.splice(n,0,e),t}function ki(t,e){let[n,r]=bn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:e.created_at-o.created_at);return r||t.splice(n,0,e),t}function bn(t,e){let n=0,r=t.length-1;for(;n<=r;){let o=Math.floor((n+r)/2),i=e(t[o]);if(i===0)return[o,!0];i<0?r=o-1:n=o+1}return[n,!1]}var kt=class{value;next=null;prev=null;constructor(e){this.value=e}},rt=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){let n=new kt(e);return this.last?this.last===this.first?(this.last=n,this.last.prev=this.first,this.first.next=n):(n.prev=this.last,this.last.next=n,this.last=n):(this.first=n,this.last=n),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let n=this.first;return this.first=null,this.last=null,n.value}let e=this.first;return this.first=e.next,e.value}};var En=class{generateSecretKey(){return We.utils.randomPrivateKey()}getPublicKey(e){return Z(We.getPublicKey(e))}finalizeEvent(e,n){let r=e;return r.pubkey=Z(We.getPublicKey(n)),r.id=Ge(r),r.sig=Z(We.sign(Ge(r),n)),r[ye]=!0,r}verifyEvent(e){if(typeof e[ye]=="boolean")return e[ye];let n=Ge(e);if(n!==e.id)return e[ye]=!1,!1;try{let r=We.verify(e.sig,n,e.pubkey);return e[ye]=r,r}catch{return e[ye]=!1,!1}}};function Kr(t){if(!nt(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Ge(t){let e=ke(te.encode(Kr(t)));return Z(e)}var Lt=new En,Li=Lt.generateSecretKey,Ii=Lt.getPublicKey,se=Lt.finalizeEvent,he=Lt.verifyEvent;var Rn={};V(Rn,{Application:()=>Is,BadgeAward:()=>Di,BadgeDefinition:()=>Us,BlockedRelaysList:()=>us,BookmarkList:()=>as,Bookmarksets:()=>As,Calendar:()=>Ms,CalendarEventRSVP:()=>Vs,ChannelCreation:()=>vn,ChannelHideMessage:()=>Tn,ChannelMessage:()=>Bn,ChannelMetadata:()=>An,ChannelMuteUser:()=>Un,ClassifiedListing:()=>Ns,ClientAuth:()=>Sn,CommunitiesList:()=>fs,CommunityDefinition:()=>zs,CommunityPostApproval:()=>Xi,Contacts:()=>Hi,CreateOrUpdateProduct:()=>Rs,CreateOrUpdateStall:()=>_s,Curationsets:()=>Bs,Date:()=>Hs,DraftClassifiedListing:()=>$s,DraftLong:()=>ks,Emojisets:()=>Ls,EncryptedDirectMessage:()=>qi,EncryptedDirectMessages:()=>Mi,EventDeletion:()=>Vi,FileMetadata:()=>Wi,FileServerPreference:()=>gs,Followsets:()=>ws,GenericRepost:()=>ji,Genericlists:()=>Es,HTTPAuth:()=>Nt,Handlerinformation:()=>js,Handlerrecommendation:()=>Ds,Highlights:()=>os,InterestsList:()=>hs,Interestsets:()=>Ss,JobFeedback:()=>es,JobRequest:()=>Qi,JobResult:()=>Fi,Label:()=>Yi,LightningPubRPC:()=>xs,LiveChatMessage:()=>Ki,LiveEvent:()=>Os,LongFormArticle:()=>Ps,Metadata:()=>Ci,Mutelist:()=>is,NWCWalletInfo:()=>ys,NWCWalletRequest:()=>_n,NWCWalletResponse:()=>ms,NostrConnect:()=>bs,OpenTimestamps:()=>zi,Pinlist:()=>ss,ProblemTracker:()=>Zi,ProfileBadges:()=>Ts,PublicChatsList:()=>ls,Reaction:()=>Ct,RecommendRelay:()=>$i,RelayList:()=>cs,Relaysets:()=>vs,Report:()=>Gi,Reporting:()=>Ji,Repost:()=>Ot,SearchRelaysList:()=>ds,ShortTextNote:()=>Ni,Time:()=>qs,UserEmojiList:()=>ps,UserStatuses:()=>Cs,Zap:()=>rs,ZapGoal:()=>ts,ZapRequest:()=>ns,classifyKind:()=>Oi,isEphemeralKind:()=>Gr,isParameterizedReplaceableKind:()=>Jr,isRegularKind:()=>Zr,isReplaceableKind:()=>It});function Zr(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function It(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function Gr(t){return 2e4<=t&&t<3e4}function Jr(t){return 3e4<=t&&t<4e4}function Oi(t){return Zr(t)?"regular":It(t)?"replaceable":Gr(t)?"ephemeral":Jr(t)?"parameterized":"unknown"}var Ci=0,Ni=1,$i=2,Hi=3,qi=4,Mi=4,Vi=5,Ot=6,Ct=7,Di=8,ji=16,vn=40,An=41,Bn=42,Tn=43,Un=44,zi=1040,Wi=1063,Ki=1311,Zi=1971,Gi=1984,Ji=1984,Yi=1985,Xi=4550,Qi=5999,Fi=6999,es=7e3,ts=9041,ns=9734,rs=9735,os=9802,is=1e4,ss=10001,cs=10002,as=10003,fs=10004,ls=10005,us=10006,ds=10007,hs=10015,ps=10030,gs=10096,ys=13194,xs=21e3,Sn=22242,_n=23194,ms=23195,bs=24133,Nt=27235,ws=3e4,Es=30001,vs=30002,As=30003,Bs=30004,Ts=30008,Us=30009,Ss=30015,_s=30017,Rs=30018,Ps=30023,ks=30024,Ls=30030,Is=30078,Os=30311,Cs=30315,Ns=30402,$s=30403,Hs=31922,qs=31923,Ms=31924,Vs=31925,Ds=31989,js=31990,zs=34550;function Yr(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1&&!t.ids.some(n=>e.id.startsWith(n))||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1&&!t.authors.some(n=>e.pubkey.startsWith(n)))return!1;for(let n in t)if(n[0]==="#"){let r=n.slice(1),o=t[`#${r}`];if(o&&!e.tags.find(([i,s])=>i===n.slice(1)&&o.indexOf(s)!==-1))return!1}return!(t.since&&e.created_at<t.since||t.until&&e.created_at>t.until)}function Pn(t,e){for(let n=0;n<t.length;n++)if(Yr(t[n],e))return!0;return!1}function Ws(...t){let e={};for(let n=0;n<t.length;n++){let r=t[n];Object.entries(r).forEach(([o,i])=>{if(o==="kinds"||o==="ids"||o==="authors"||o[0]==="#"){e[o]=e[o]||[];for(let s=0;s<i.length;s++){let c=i[s];e[o].includes(c)||e[o].push(c)}}}),r.limit&&(!e.limit||r.limit>e.limit)&&(e.limit=r.limit),r.until&&(!e.until||r.until>e.until)&&(e.until=r.until),r.since&&(!e.since||r.since<e.since)&&(e.since=r.since)}return e}function Ks(t){return t.ids&&!t.ids.length||t.kinds&&!t.kinds.length||t.authors&&!t.authors.length?0:Math.min(Math.max(0,t.limit??1/0),t.ids?.length??1/0,t.authors?.length&&t.kinds?.every(e=>It(e))?t.authors.length*t.kinds.length:1/0)}var Ln={};V(Ln,{getHex64:()=>ot,getInt:()=>Xr,getSubscriptionId:()=>kn,matchEventId:()=>Zs,matchEventKind:()=>Js,matchEventPubkey:()=>Gs});function ot(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,o=t.slice(r).indexOf('"')+r+1;return t.slice(o,o+64)}function Xr(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,o=t.slice(r),i=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,i),10)}function kn(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,o=t.slice(r+1,80).indexOf('"');if(o===-1)return null;let i=r+1+o;return t.slice(r+1,i)}function Zs(t,e){return e===ot(t,"id")}function Gs(t,e){return e===ot(t,"pubkey")}function Js(t,e){return e===Xr(t,"kind")}var On={};V(On,{makeAuthEvent:()=>In});function In(t,e){return{kind:Sn,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}async function Qr(){return new Promise(t=>{let e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()})}var Fr=t=>(t[ye]=!0,!0);var be=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);baseEoseTimeout=4400;connectionTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new rt;queueRunning=!1;challenge;serial=0;verifyEvent;constructor(e,n){this.url=Le(e),this.verifyEvent=n.verifyEvent}static async connect(e,n){let r=new be(e,n);return await r.connect(),r}closeAllSubscriptions(e){for(let[n,r]of this.openSubs)r.close(e);this.openSubs.clear();for(let[n,r]of this.openEventPublishes)r.reject(new Error(e));this.openEventPublishes.clear();for(let[n,r]of this.openCountRequests)r.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.connectionPromise=new Promise((e,n)=>{this.connectionTimeoutHandle=setTimeout(()=>{n("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new WebSocket(this.url)}catch(r){n(r);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=r=>{n(r.message),this._connected&&(this.onclose?.(),this.closeAllSubscriptions("relay connection errored"),this._connected=!1)},this.ws.onclose=async()=>{this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"),this._connected=!1},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Qr();this.queueRunning=!1}handleNext(){let e=this.incomingMessageQueue.dequeue();if(!e)return!1;let n=kn(e);if(n){let r=this.openSubs.get(n);if(!r)return;let o=ot(e,"id"),i=r.alreadyHaveEvent?.(o);if(r.receivedEvent?.(this,o),i)return}try{let r=JSON.parse(e);switch(r[0]){case"EVENT":{let o=this.openSubs.get(r[1]),i=r[2];this.verifyEvent(i)&&Pn(o.filters,i)&&o.onevent(i);return}case"COUNT":{let o=r[1],i=r[2],s=this.openCountRequests.get(o);s&&(s.resolve(i.count),this.openCountRequests.delete(o));return}case"EOSE":{let o=this.openSubs.get(r[1]);if(!o)return;o.receivedEose();return}case"OK":{let o=r[1],i=r[2],s=r[3],c=this.openEventPublishes.get(o);i?c.resolve(s):c.reject(new Error(s)),this.openEventPublishes.delete(o);return}case"CLOSED":{let o=r[1],i=this.openSubs.get(o);if(!i)return;i.closed=!0,i.close(r[2]);return}case"NOTICE":this.onnotice(r[1]);return;case"AUTH":{this.challenge=r[1];return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then(()=>{this.ws?.send(e)})}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");let n=await e(In(this.url,this.challenge)),r=new Promise((o,i)=>{this.openEventPublishes.set(n.id,{resolve:o,reject:i})});return this.send('["AUTH",'+JSON.stringify(n)+"]"),r}async publish(e){let n=new Promise((r,o)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:o})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),n}async count(e,n){this.serial++;let r=n?.id||"count:"+this.serial,o=new Promise((i,s)=>{this.openCountRequests.set(r,{resolve:i,reject:s})});return this.send('["COUNT","'+r+'",'+JSON.stringify(e)+"]"),o}subscribe(e,n){let r=this.prepareSubscription(e,n);return r.fire(),r}prepareSubscription(e,n){this.serial++;let r=n.id||"sub:"+this.serial,o=new $t(this,r,e,n);return this.openSubs.set(r,o),o}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},$t=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,n,r,o){this.relay=e,this.filters=r,this.id=n,this.alreadyHaveEvent=o.alreadyHaveEvent,this.receivedEvent=o.receivedEvent,this.eoseTimeout=o.eoseTimeout||e.baseEoseTimeout,this.oneose=o.oneose,this.onclose=o.onclose,this.onevent=o.onevent||(i=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,i)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){this.closed||(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(e)}};function Ys(t){return Je.connect(t)}var Je=class extends be{constructor(e){super(e,{verifyEvent:he})}static async connect(e){let n=new Je(e);return await n.connect(),n}};var it=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;constructor(e){this.verifyEvent=e.verifyEvent}async ensureRelay(e,n){e=Le(e);let r=this.relays.get(e);return r||(r=new be(e,{verifyEvent:this.trustedRelayURLs.has(e)?Fr:this.verifyEvent}),n?.connectionTimeout&&(r.connectionTimeout=n.connectionTimeout),this.relays.set(e,r)),await r.connect(),r}close(e){e.map(Le).forEach(n=>{this.relays.get(n)?.close()})}subscribeMany(e,n,r){this.trackRelays&&(r.receivedEvent=(p,x)=>{let m=this.seenOn.get(x);m||(m=new Set,this.seenOn.set(x,m)),m.add(p)});let o=new Set,i=[],s=[],c=p=>{s[p]=!0,s.filter(x=>x).length===e.length&&(r.oneose?.(),c=()=>{})},a=[],f=(p,x)=>{c(p),a[p]=x,a.filter(m=>m).length===e.length&&(r.onclose?.(a),f=()=>{})},u=p=>{if(r.alreadyHaveEvent?.(p))return!0;let x=o.has(p);return o.add(p),x},l=Promise.all(e.map(Le).map(async(p,x,m)=>{if(m.indexOf(p)!==x){f(x,"duplicate url");return}let d;try{d=await this.ensureRelay(p,{connectionTimeout:r.maxWait?Math.max(r.maxWait*.8,r.maxWait-1e3):void 0})}catch(w){f(x,w?.message||String(w));return}let g=d.subscribe(n,{...r,oneose:()=>c(x),onclose:w=>f(x,w),alreadyHaveEvent:u,eoseTimeout:r.maxWait});i.push(g)}));return{async close(){await l,i.forEach(p=>{p.close()})}}}subscribeManyEose(e,n,r){let o=this.subscribeMany(e,n,{...r,oneose(){o.close()}});return o}async querySync(e,n,r){return new Promise(async o=>{let i=[];this.subscribeManyEose(e,[n],{...r,onevent(s){i.push(s)},onclose(s){o(i)}})})}async get(e,n,r){n.limit=1;let o=await this.querySync(e,n,r);return o.sort((i,s)=>s.created_at-i.created_at),o[0]||null}publish(e,n){return e.map(Le).map(async(r,o,i)=>i.indexOf(r)!==o?Promise.reject("duplicate url"):(await this.ensureRelay(r)).publish(n))}};var Cn=class extends it{constructor(){super({verifyEvent:he})}};var Dn={};V(Dn,{BECH32_REGEX:()=>Vn,Bech32MaxSize:()=>Mn,decode:()=>Ce,encodeBytes:()=>Vt,naddrEncode:()=>uc,neventEncode:()=>lc,noteEncode:()=>ac,nprofileEncode:()=>fc,npubEncode:()=>cc,nrelayEncode:()=>dc,nsecEncode:()=>sc});function Ye(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function we(...t){let e=(o,i)=>s=>o(i(s)),n=Array.from(t).reverse().reduce((o,i)=>o?e(o,i.encode):i.encode,void 0),r=t.reduce((o,i)=>o?e(o,i.decode):i.decode,void 0);return{encode:n,decode:r}}function Ee(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(Ye(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);let r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function ve(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function qt(t,e="="){if(Ye(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function io(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function eo(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0,o=[],i=Array.from(t);for(i.forEach(s=>{if(Ye(s),s<0||s>=e)throw new Error(`Wrong integer: ${s}`)});;){let s=0,c=!0;for(let a=r;a<i.length;a++){let f=i[a],u=e*s+f;if(!Number.isSafeInteger(u)||e*s/e!==s||u-f!==e*s)throw new Error("convertRadix: carry overflow");if(s=u%n,i[a]=Math.floor(u/n),!Number.isSafeInteger(i[a])||i[a]*n+s!==u)throw new Error("convertRadix: carry overflow");if(c)i[a]?c=!1:r=a;else continue}if(o.push(s),c)break}for(let s=0;s<t.length-1&&t[s]===0;s++)o.push(0);return o.reverse()}var so=(t,e)=>e?so(e,t%e):t,Ht=(t,e)=>t+(e-so(t,e));function Nn(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Ht(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Ht(e,n)}`);let o=0,i=0,s=2**n-1,c=[];for(let a of t){if(Ye(a),a>=2**e)throw new Error(`convertRadix2: invalid data word=${a} from=${e}`);if(o=o<<e|a,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=n;i-=n)c.push((o>>i-n&s)>>>0);o&=2**i-1}if(o=o<<n-i&s,!r&&i>=e)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&i>0&&c.push(o>>>0),c}function Xs(t){return Ye(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return eo(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(eo(e,t,2**8))}}}function Ie(t,e=!1){if(Ye(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Ht(8,t)>32||Ht(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Nn(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Nn(n,t,8,e))}}}function to(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}var Qs=we(Ie(4),Ee("0123456789ABCDEF"),ve("")),Fs=we(Ie(5),Ee("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),qt(5),ve("")),Al=we(Ie(5),Ee("0123456789ABCDEFGHIJKLMNOPQRSTUV"),qt(5),ve("")),Bl=we(Ie(5),Ee("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),ve(""),io(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),fe=we(Ie(6),Ee("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),qt(6),ve("")),ec=we(Ie(6),Ee("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),qt(6),ve("")),qn=t=>we(Xs(58),Ee(t),ve("")),$n=qn("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Tl=qn("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Ul=qn("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),no=[0,2,3,5,6,7,9,10,11],tc={encode(t){let e="";for(let n=0;n<t.length;n+=8){let r=t.subarray(n,n+8);e+=$n.encode(r).padStart(no[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){let r=t.slice(n,n+11),o=no.indexOf(r.length),i=$n.decode(r);for(let s=0;s<i.length-o;s++)if(i[s]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(i.slice(i.length-o)))}return Uint8Array.from(e)}};var Hn=we(Ee("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ve("")),ro=[996825010,642813549,513874426,1027748829,705979059];function st(t){let e=t>>25,n=(t&33554431)<<5;for(let r=0;r<ro.length;r++)(e>>r&1)===1&&(n^=ro[r]);return n}function oo(t,e,n=1){let r=t.length,o=1;for(let i=0;i<r;i++){let s=t.charCodeAt(i);if(s<33||s>126)throw new Error(`Invalid prefix (${t})`);o=st(o)^s>>5}o=st(o);for(let i=0;i<r;i++)o=st(o)^t.charCodeAt(i)&31;for(let i of e)o=st(o)^i;for(let i=0;i<6;i++)o=st(o);return o^=n,Hn.encode(Nn([o%2**30],30,5,!1))}function co(t){let e=t==="bech32"?1:734539939,n=Ie(5),r=n.decode,o=n.encode,i=to(r);function s(u,l,p=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof l}`);let x=u.length+7+l.length;if(p!==!1&&x>p)throw new TypeError(`Length ${x} exceeds limit ${p}`);return u=u.toLowerCase(),`${u}1${Hn.encode(l)}${oo(u,l,e)}`}function c(u,l=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||l!==!1&&u.length>l)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${l})`);let p=u.toLowerCase();if(u!==p&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=p;let x=u.lastIndexOf("1");if(x===0||x===-1)throw new Error('Letter "1" must be present between prefix and data only');let m=u.slice(0,x),d=u.slice(x+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");let g=Hn.decode(d).slice(0,-6),w=oo(m,g,e);if(!d.endsWith(w))throw new Error(`Invalid checksum in ${u}: expected "${w}"`);return{prefix:m,words:g}}let a=to(c);function f(u){let{prefix:l,words:p}=c(u,!1);return{prefix:l,words:p,bytes:r(p)}}return{encode:s,decode:c,decodeToBytes:f,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:i,toWords:o}}var Oe=co("bech32"),Sl=co("bech32m"),nc={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},rc=we(Ie(4),Ee("0123456789abcdef"),ve(""),io(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),oc={utf8:nc,hex:rc,base16:Qs,base32:Fs,base64:fe,base64url:ec,base58:$n,base58xmr:tc},_l=`Invalid encoding type. Available types: ${Object.keys(oc).join(", ")}`;var Mn=5e3,Vn=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function ic(t){let e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function Ce(t){let{prefix:e,words:n}=Oe.decode(t,Mn),r=new Uint8Array(Oe.fromWords(n));switch(e){case"nprofile":{let o=Mt(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Z(o[0][0]),relays:o[1]?o[1].map(i=>ie.decode(i)):[]}}}case"nevent":{let o=Mt(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Z(o[0][0]),relays:o[1]?o[1].map(i=>ie.decode(i)):[],author:o[2]?.[0]?Z(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(Z(o[3][0]),16):void 0}}}case"naddr":{let o=Mt(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:ie.decode(o[0][0]),pubkey:Z(o[2][0]),kind:parseInt(Z(o[3][0]),16),relays:o[1]?o[1].map(i=>ie.decode(i)):[]}}}case"nrelay":{let o=Mt(r);if(!o[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:ie.decode(o[0][0])}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:Z(r)};default:throw new Error(`unknown prefix ${e}`)}}function Mt(t){let e={},n=t;for(;n.length>0;){let r=n[0],o=n[1],i=n.slice(2,2+o);if(n=n.slice(2+o),i.length<o)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(i)}return e}function sc(t){return Vt("nsec",t)}function cc(t){return Vt("npub",Me(t))}function ac(t){return Vt("note",Me(t))}function ct(t,e){let n=Oe.toWords(e);return Oe.encode(t,n,Mn)}function Vt(t,e){return ct(t,e)}function fc(t){let e=Dt({0:[Me(t.pubkey)],1:(t.relays||[]).map(n=>te.encode(n))});return ct("nprofile",e)}function lc(t){let e;t.kind!==void 0&&(e=ic(t.kind));let n=Dt({0:[Me(t.id)],1:(t.relays||[]).map(r=>te.encode(r)),2:t.author?[Me(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return ct("nevent",n)}function uc(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=Dt({0:[te.encode(t.identifier)],1:(t.relays||[]).map(r=>te.encode(r)),2:[Me(t.pubkey)],3:[new Uint8Array(e)]});return ct("naddr",n)}function dc(t){let e=Dt({0:[te.encode(t)]});return ct("nrelay",e)}function Dt(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(o=>{let i=new Uint8Array(o.length+2);i.set([parseInt(n)],0),i.set([o.length],1),i.set(o,2),e.push(i)})}),Ze(...e)}var hc=/\bnostr:((note|npub|naddr|nevent|nprofile)1\w+)\b|#\[(\d+)\]/g;function pc(t){let e=[];for(let n of t.content.matchAll(hc))if(n[2])try{let{type:r,data:o}=Ce(n[1]);switch(r){case"npub":{e.push({text:n[0],profile:{pubkey:o,relays:[]}});break}case"nprofile":{e.push({text:n[0],profile:o});break}case"note":{e.push({text:n[0],event:{id:o,relays:[]}});break}case"nevent":{e.push({text:n[0],event:o});break}case"naddr":{e.push({text:n[0],address:o});break}}}catch{}else if(n[3]){let r=parseInt(n[3],10),o=t.tags[r];if(!o)continue;switch(o[0]){case"p":{e.push({text:n[0],profile:{pubkey:o[1],relays:o[2]?[o[2]]:[]}});break}case"e":{e.push({text:n[0],event:{id:o[1],relays:o[2]?[o[2]]:[]}});break}case"a":{try{let[i,s,c]=o[1].split(":");e.push({text:n[0],address:{identifier:c,pubkey:s,kind:parseInt(i,10),relays:o[2]?[o[2]]:[]}})}catch{}break}}}return e}var zn={};V(zn,{decrypt:()=>gc,encrypt:()=>jn});typeof crypto<"u"&&!crypto.subtle&&crypto.webcrypto&&(crypto.subtle=crypto.webcrypto.subtle);async function jn(t,e,n){let r=t instanceof Uint8Array?Z(t):t,o=Se.getSharedSecret(r,"02"+e),i=ao(o),s=Uint8Array.from(_t(16)),c=te.encode(n),a=await crypto.subtle.importKey("raw",i,{name:"AES-CBC"},!1,["encrypt"]),f=await crypto.subtle.encrypt({name:"AES-CBC",iv:s},a,c),u=fe.encode(new Uint8Array(f)),l=fe.encode(new Uint8Array(s.buffer));return`${u}?iv=${l}`}async function gc(t,e,n){let r=t instanceof Uint8Array?Z(t):t,[o,i]=n.split("?iv="),s=Se.getSharedSecret(r,"02"+e),c=ao(s),a=await crypto.subtle.importKey("raw",c,{name:"AES-CBC"},!1,["decrypt"]),f=fe.decode(o),u=fe.decode(i),l=await crypto.subtle.decrypt({name:"AES-CBC",iv:u},a,f);return ie.decode(l)}function ao(t){return t.slice(1,33)}var Wn={};V(Wn,{NIP05_REGEX:()=>fo,queryProfile:()=>mc,searchDomain:()=>xc,useFetchImplementation:()=>yc});var fo=/^(?:([\w.+-]+)@)?([\w.-]+)$/,jt;try{jt=fetch}catch{}function yc(t){jt=t}async function xc(t,e=""){try{return(await(await jt(`https://${t}/.well-known/nostr.json?name=${e}`)).json()).names}catch{return{}}}async function mc(t){let e=t.match(fo);if(!e)return null;let[n,r="_",o]=e;try{let i=await jt(`https://${o}/.well-known/nostr.json?name=${r}`),{names:s,relays:c}=bc(await i.json()),a=s[r];return a?{pubkey:a,relays:c?.[a]}:null}catch{return null}}function bc(t){let e={names:{}};for(let[n,r]of Object.entries(t.names))typeof n=="string"&&typeof r=="string"&&(e.names[n]=r);if(t.relays){e.relays={};for(let[n,r]of Object.entries(t.relays))typeof n=="string"&&Array.isArray(r)&&(e.relays[n]=r.filter(o=>typeof o=="string"))}return e}var Kn={};V(Kn,{parse:()=>wc});function wc(t){let e={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(let r of t.tags)r[0]==="e"&&r[1]&&n.push(r),r[0]==="p"&&r[1]&&e.profiles.push({pubkey:r[1],relays:r[2]?[r[2]]:[]});for(let r=0;r<n.length;r++){let o=n[r],[i,s,c,a]=o,f={id:s,relays:c?[c]:[]},u=r===0,l=r===n.length-1;if(a==="root"){e.root=f;continue}if(a==="reply"){e.reply=f;continue}if(a==="mention"){e.mentions.push(f);continue}if(u){e.root=f;continue}if(l){e.reply=f;continue}e.mentions.push(f)}return e}var Zn={};V(Zn,{fetchRelayInformation:()=>vc,useFetchImplementation:()=>Ec});var lo;try{lo=fetch}catch{}function Ec(t){lo=t}async function vc(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var Gn={};V(Gn,{getPow:()=>uo,minePow:()=>Ac});function uo(t){let e=0;for(let n=0;n<t.length;n++){let r=parseInt(t[n],16);if(r===0)e+=4;else{e+=Math.clz32(r)-28;break}}return e}function Ac(t,e){let n=0,r=t,o=["nonce",n.toString(),e.toString()];for(r.tags.push(o);;){let i=Math.floor(new Date().getTime()/1e3);if(i!==r.created_at&&(n=0,r.created_at=i),o[1]=(++n).toString(),r.id=Ge(r),uo(r.id)>=e)break}return r}var Jn={};V(Jn,{finishRepostEvent:()=>Bc,getRepostedEvent:()=>Tc,getRepostedEventPointer:()=>ho});function Bc(t,e,n,r){return se({kind:Ot,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:t.content===""?"":JSON.stringify(e),created_at:t.created_at},r)}function ho(t){if(t.kind!==Ot)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){let o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(e!==void 0)return{id:e[1],relays:[e[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function Tc(t,{skipVerification:e}={}){let n=ho(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!he(r)))return r}var Yn={};V(Yn,{NOSTR_URI_REGEX:()=>at,parse:()=>Sc,test:()=>Uc});var at=new RegExp(`nostr:(${Vn.source})`);function Uc(t){return typeof t=="string"&&new RegExp(`^${at.source}$`).test(t)}function Sc(t){let e=t.match(new RegExp(`^${at.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:Ce(e[1])}}var Xn={};V(Xn,{finishReactionEvent:()=>_c,getReactedEventPointer:()=>Rc});function _c(t,e,n){let r=e.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return se({...t,kind:Ct,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function Rc(t){if(t.kind!==Ct)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){let o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Fn={};V(Fn,{matchAll:()=>Pc,regex:()=>Qn,replaceAll:()=>kc});var Qn=()=>new RegExp(`\\b${at.source}\\b`,"g");function*Pc(t){let e=t.matchAll(Qn());for(let n of e)try{let[r,o]=n;yield{uri:r,value:o,decoded:Ce(o),start:n.index,end:n.index+r.length}}catch{}}function kc(t,e){return t.replaceAll(Qn(),(n,r)=>e({uri:n,value:r,decoded:Ce(r)}))}var er={};V(er,{channelCreateEvent:()=>Lc,channelHideMessageEvent:()=>Cc,channelMessageEvent:()=>Oc,channelMetadataEvent:()=>Ic,channelMuteUserEvent:()=>Nc});var Lc=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return se({kind:vn,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},Ic=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return se({kind:An,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Oc=(t,e)=>{let n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),se({kind:Bn,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},Cc=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return se({kind:Tn,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Nc=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return se({kind:Un,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)};var nr={};V(nr,{EMOJI_SHORTCODE_REGEX:()=>po,matchAll:()=>$c,regex:()=>tr,replaceAll:()=>Hc});var po=/:(\w+):/,tr=()=>new RegExp(`\\B${po.source}\\B`,"g");function*$c(t){let e=t.matchAll(tr());for(let n of e)try{let[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function Hc(t,e){return t.replaceAll(tr(),(n,r)=>e({shortcode:n,name:r}))}var or={};V(or,{useFetchImplementation:()=>qc,validateGithub:()=>Mc});var rr;try{rr=fetch}catch{}function qc(t){rr=t}async function Mc(t,e,n){try{return await(await rr(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var lr={};V(lr,{default:()=>ia,v2:()=>vo});var Vc=t=>t instanceof Uint8Array;var Ae=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4));var Dc=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Dc)throw new Error("Non little-endian hardware is not supported");function zt(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Wt(t){if(typeof t=="string"&&(t=zt(t)),!Vc(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}var jc=t=>Object.prototype.toString.call(t)==="[object Object]"&&t.constructor===Object;function go(t,e){if(e!==void 0&&(typeof e!="object"||!jc(e)))throw new Error("options must be object or undefined");return Object.assign(t,e)}function Xe(t,e){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");if(typeof e=="number"&&t.length!==e)throw new Error(`Uint8Array length ${e} expected`)}function ir(t,e){if(t.length!==e.length)throw new Error("equalBytes: Different size of Uint8Arrays");let n=!0;for(let r=0;r<t.length;r++)n&&(n=t[r]===e[r]);return n}function sr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function zc(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function yo(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function Wc(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("hash must be wrapped by utils.wrapConstructor");sr(t.outputLen),sr(t.blockLen)}function Kc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Zc(t,e){yo(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Gc={number:sr,bool:zc,bytes:yo,hash:Wc,exists:Kc,output:Zc},F=Gc;var J=(t,e)=>t[e++]&255|(t[e++]&255)<<8,cr=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Wt(e),Xe(e,32);let n=J(e,0),r=J(e,2),o=J(e,4),i=J(e,6),s=J(e,8),c=J(e,10),a=J(e,12),f=J(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|i<<9)&8191,this.r[4]=(i>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|c<<2)&8191,this.r[7]=(c>>>11|a<<5)&8065,this.r[8]=(a>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let u=0;u<8;u++)this.pad[u]=J(e,16+2*u)}process(e,n,r=!1){let o=r?0:2048,{h:i,r:s}=this,c=s[0],a=s[1],f=s[2],u=s[3],l=s[4],p=s[5],x=s[6],m=s[7],d=s[8],g=s[9],w=J(e,n+0),R=J(e,n+2),P=J(e,n+4),N=J(e,n+6),O=J(e,n+8),E=J(e,n+10),A=J(e,n+12),T=J(e,n+14),S=i[0]+(w&8191),_=i[1]+((w>>>13|R<<3)&8191),B=i[2]+((R>>>10|P<<6)&8191),L=i[3]+((P>>>7|N<<9)&8191),I=i[4]+((N>>>4|O<<12)&8191),q=i[5]+(O>>>1&8191),h=i[6]+((O>>>14|E<<2)&8191),y=i[7]+((E>>>11|A<<5)&8191),v=i[8]+((A>>>8|T<<8)&8191),k=i[9]+(T>>>5|o),b=0,C=b+S*c+_*(5*g)+B*(5*d)+L*(5*m)+I*(5*x);b=C>>>13,C&=8191,C+=q*(5*p)+h*(5*l)+y*(5*u)+v*(5*f)+k*(5*a),b+=C>>>13,C&=8191;let H=b+S*a+_*c+B*(5*g)+L*(5*d)+I*(5*m);b=H>>>13,H&=8191,H+=q*(5*x)+h*(5*p)+y*(5*l)+v*(5*u)+k*(5*f),b+=H>>>13,H&=8191;let $=b+S*f+_*a+B*c+L*(5*g)+I*(5*d);b=$>>>13,$&=8191,$+=q*(5*m)+h*(5*x)+y*(5*p)+v*(5*l)+k*(5*u),b+=$>>>13,$&=8191;let K=b+S*u+_*f+B*a+L*c+I*(5*g);b=K>>>13,K&=8191,K+=q*(5*d)+h*(5*m)+y*(5*x)+v*(5*p)+k*(5*l),b+=K>>>13,K&=8191;let X=b+S*l+_*u+B*f+L*a+I*c;b=X>>>13,X&=8191,X+=q*(5*g)+h*(5*d)+y*(5*m)+v*(5*x)+k*(5*p),b+=X>>>13,X&=8191;let ne=b+S*p+_*l+B*u+L*f+I*a;b=ne>>>13,ne&=8191,ne+=q*c+h*(5*g)+y*(5*d)+v*(5*m)+k*(5*x),b+=ne>>>13,ne&=8191;let ce=b+S*x+_*p+B*l+L*u+I*f;b=ce>>>13,ce&=8191,ce+=q*a+h*c+y*(5*g)+v*(5*d)+k*(5*m),b+=ce>>>13,ce&=8191;let Q=b+S*m+_*x+B*p+L*l+I*u;b=Q>>>13,Q&=8191,Q+=q*f+h*a+y*c+v*(5*g)+k*(5*d),b+=Q>>>13,Q&=8191;let pe=b+S*d+_*m+B*x+L*p+I*l;b=pe>>>13,pe&=8191,pe+=q*u+h*f+y*a+v*c+k*(5*g),b+=pe>>>13,pe&=8191;let ee=b+S*g+_*d+B*m+L*x+I*p;b=ee>>>13,ee&=8191,ee+=q*l+h*u+y*f+v*a+k*c,b+=ee>>>13,ee&=8191,b=(b<<2)+b|0,b=b+C|0,C=b&8191,b=b>>>13,H+=b,i[0]=C,i[1]=H,i[2]=$,i[3]=K,i[4]=X,i[5]=ne,i[6]=ce,i[7]=Q,i[8]=pe,i[9]=ee}finalize(){let{h:e,pad:n}=this,r=new Uint16Array(10),o=e[1]>>>13;e[1]&=8191;for(let c=2;c<10;c++)e[c]+=o,o=e[c]>>>13,e[c]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,r[0]=e[0]+5,o=r[0]>>>13,r[0]&=8191;for(let c=1;c<10;c++)r[c]=e[c]+o,o=r[c]>>>13,r[c]&=8191;r[9]-=1<<13;let i=(o^1)-1;for(let c=0;c<10;c++)r[c]&=i;i=~i;for(let c=0;c<10;c++)e[c]=e[c]&i|r[c];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+n[0];e[0]=s&65535;for(let c=1;c<8;c++)s=(e[c]+n[c]|0)+(s>>>16)|0,e[c]=s&65535}update(e){F.exists(this);let{buffer:n,blockLen:r}=this;e=Wt(e);let o=e.length;for(let i=0;i<o;){let s=Math.min(r-this.pos,o-i);if(s===r){for(;r<=o-i;i+=r)this.process(e,i);continue}n.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){F.exists(this),F.output(e,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let i=0;for(let s=0;s<8;s++)e[i++]=r[s]>>>0,e[i++]=r[s]>>>8;return e}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}};function Jc(t){let e=(r,o)=>t(o).update(Wt(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}var Yc=Jc(t=>new cr(t));var Xc=zt("expand 16-byte k"),Qc=zt("expand 32-byte k"),Fc=Ae(Xc),ea=Ae(Qc),xo=t=>!(t.byteOffset%4),mo=t=>{let{core:e,rounds:n,counterRight:r,counterLen:o,allow128bitKeys:i,extendNonceFn:s,blockLen:c}=go({rounds:20,counterRight:!1,counterLen:8,allow128bitKeys:!0,blockLen:64},t);F.number(o),F.number(n),F.number(c),F.bool(r),F.bool(i);let a=c/4;if(c%4!==0)throw new Error("Salsa/ChaCha: blockLen must be aligned to 4 bytes");return(f,u,l,p,x=0)=>{if(F.bytes(f),F.bytes(u),F.bytes(l),p||(p=new Uint8Array(l.length)),F.bytes(p),F.number(x),x<0||x>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");if(p.length<l.length)throw new Error(`Salsa/ChaCha: output (${p.length}) is shorter than data (${l.length})`);let m=[],d,g;if(f.length===32)d=f,g=ea;else if(f.length===16&&i)d=new Uint8Array(32),d.set(f),d.set(f,16),g=Fc,m.push(d);else throw new Error(`Salsa/ChaCha: invalid 32-byte key, got length=${f.length}`);if(s){if(u.length<=16)throw new Error("Salsa/ChaCha: extended nonce must be bigger than 16 bytes");d=s(g,d,u.subarray(0,16),new Uint8Array(32)),m.push(d),u=u.subarray(16)}let w=16-o;if(u.length!==w)throw new Error(`Salsa/ChaCha: nonce must be ${w} or 16 bytes`);if(w!==12){let S=new Uint8Array(12);S.set(u,r?0:12-u.length),m.push(u=S)}let R=new Uint8Array(c),P=Ae(R),N=Ae(d),O=Ae(u),E=xo(l)&&Ae(l),A=xo(p)&&Ae(p);m.push(P);let T=l.length;for(let S=0,_=x;S<T;_++){if(e(g,N,O,P,_,n),_>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");let B=Math.min(c,T-S);if(B===c&&A&&E){let L=S/4;if(S%4!==0)throw new Error("Salsa/ChaCha: invalid block position");for(let I=0;I<a;I++)A[L+I]=E[L+I]^P[I];S+=c;continue}for(let L=0;L<B;L++)p[S+L]=l[S+L]^R[L];S+=B}for(let S=0;S<m.length;S++)m[S].fill(0);return p}};var M=(t,e)=>t<<e|t>>>32-e;function ta(t,e,n,r,o,i=20){let s=t[0],c=t[1],a=t[2],f=t[3],u=e[0],l=e[1],p=e[2],x=e[3],m=e[4],d=e[5],g=e[6],w=e[7],R=o,P=n[0],N=n[1],O=n[2],E=s,A=c,T=a,S=f,_=u,B=l,L=p,I=x,q=m,h=d,y=g,v=w,k=R,b=P,C=N,H=O;for(let K=0;K<i;K+=2)E=E+_|0,k=M(k^E,16),q=q+k|0,_=M(_^q,12),E=E+_|0,k=M(k^E,8),q=q+k|0,_=M(_^q,7),A=A+B|0,b=M(b^A,16),h=h+b|0,B=M(B^h,12),A=A+B|0,b=M(b^A,8),h=h+b|0,B=M(B^h,7),T=T+L|0,C=M(C^T,16),y=y+C|0,L=M(L^y,12),T=T+L|0,C=M(C^T,8),y=y+C|0,L=M(L^y,7),S=S+I|0,H=M(H^S,16),v=v+H|0,I=M(I^v,12),S=S+I|0,H=M(H^S,8),v=v+H|0,I=M(I^v,7),E=E+B|0,H=M(H^E,16),y=y+H|0,B=M(B^y,12),E=E+B|0,H=M(H^E,8),y=y+H|0,B=M(B^y,7),A=A+L|0,k=M(k^A,16),v=v+k|0,L=M(L^v,12),A=A+L|0,k=M(k^A,8),v=v+k|0,L=M(L^v,7),T=T+I|0,b=M(b^T,16),q=q+b|0,I=M(I^q,12),T=T+I|0,b=M(b^T,8),q=q+b|0,I=M(I^q,7),S=S+_|0,C=M(C^S,16),h=h+C|0,_=M(_^h,12),S=S+_|0,C=M(C^S,8),h=h+C|0,_=M(_^h,7);let $=0;r[$++]=s+E|0,r[$++]=c+A|0,r[$++]=a+T|0,r[$++]=f+S|0,r[$++]=u+_|0,r[$++]=l+B|0,r[$++]=p+L|0,r[$++]=x+I|0,r[$++]=m+q|0,r[$++]=d+h|0,r[$++]=g+y|0,r[$++]=w+v|0,r[$++]=R+k|0,r[$++]=P+b|0,r[$++]=N+C|0,r[$++]=O+H|0}var ar=mo({core:ta,counterRight:!1,counterLen:4,allow128bitKeys:!1});var Kt=class extends Ke{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,oe.hash(e);let r=_e(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?e.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(e){return oe.exists(this),this.iHash.update(e),this}digestInto(e){oe.exists(this),oe.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Qe=(t,e,n)=>new Kt(t,e).update(n).digest();Qe.create=(t,e)=>new Kt(t,e);function wo(t,e,n){return oe.hash(t),n===void 0&&(n=new Uint8Array(t.outputLen)),Qe(t,_e(n),_e(e))}var fr=new Uint8Array([0]),bo=new Uint8Array;function Eo(t,e,n,r=32){if(oe.hash(t),oe.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");let o=Math.ceil(r/t.outputLen);n===void 0&&(n=bo);let i=new Uint8Array(o*t.outputLen),s=Qe.create(t,e),c=s._cloneInto(),a=new Uint8Array(s.outputLen);for(let f=0;f<o;f++)fr[0]=f+1,c.update(f===0?bo:a).update(n).update(fr).digestInto(a),i.set(a,t.outputLen*f),s._cloneInto(c);return s.destroy(),c.destroy(),a.fill(0),fr.fill(0),i.slice(0,r)}var na=new TextDecoder,Y={minPlaintextSize:1,maxPlaintextSize:65535,utf8Encode:gn,utf8Decode(t){return na.decode(t)},getConversationKey(t,e){let n=Se.getSharedSecret(t,"02"+e).subarray(1,33);return wo(ke,n,"nip44-v2")},getMessageKeys(t,e){Xe(t,32),Xe(e,32);let n=Eo(ke,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}},calcPaddedLen(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;let e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)},writeU16BE(t){if(!Number.isSafeInteger(t)||t<Y.minPlaintextSize||t>Y.maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");let e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e},pad(t){let e=Y.utf8Encode(t),n=e.length,r=Y.writeU16BE(n),o=new Uint8Array(Y.calcPaddedLen(n)-n);return Ze(r,e,o)},unpad(t){let e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<Y.minPlaintextSize||e>Y.maxPlaintextSize||n.length!==e||t.length!==2+Y.calcPaddedLen(e))throw new Error("invalid padding");return Y.utf8Decode(n)},hmacAad(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");let r=Ze(n,e);return Qe(ke,t,r)},decodePayload(t){if(typeof t!="string")throw new Error("payload must be a valid string");let e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=fe.decode(t)}catch(i){throw new Error("invalid base64: "+i.message)}let r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);let o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}};function ra(t,e,n=_t(32)){let{chacha_key:r,chacha_nonce:o,hmac_key:i}=Y.getMessageKeys(e,n),s=Y.pad(t),c=ar(r,o,s),a=Y.hmacAad(i,c,n);return fe.encode(Ze(new Uint8Array([2]),n,c,a))}function oa(t,e){let{nonce:n,ciphertext:r,mac:o}=Y.decodePayload(t),{chacha_key:i,chacha_nonce:s,hmac_key:c}=Y.getMessageKeys(e,n),a=Y.hmacAad(c,r,n);if(!ir(a,o))throw new Error("invalid MAC");let f=ar(i,s,r);return Y.unpad(f)}var vo={utils:Y,encrypt:ra,decrypt:oa},ia={v2:vo};var ur={};V(ur,{makeNwcRequestEvent:()=>ca,parseConnectionString:()=>sa});function sa(t){let{pathname:e,searchParams:n}=new URL(t),r=e,o=n.get("relay"),i=n.get("secret");if(!r||!o||!i)throw new Error("invalid connection string");return{pubkey:r,relay:o,secret:i}}async function ca(t,e,n){let r={method:"pay_invoice",params:{invoice:n}},o=await jn(e,t,JSON.stringify(r)),i={kind:_n,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t]]};return se(i,e)}var hr={};V(hr,{getZapEndpoint:()=>fa,makeZapReceipt:()=>da,makeZapRequest:()=>la,useFetchImplementation:()=>aa,validateZapRequest:()=>ua});var dr;try{dr=fetch}catch{}function aa(t){dr=t}async function fa(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:s}=Oe.decode(n,1e3),c=Oe.fromWords(s);e=ie.decode(c)}else if(r){let[s,c]=r.split("@");e=new URL(`/.well-known/lnurlp/${s}`,`https://${c}`).toString()}else return null;let i=await(await dr(e)).json();if(i.allowsNostr&&i.nostrPubkey)return i.callback}catch{}return null}function la({profile:t,event:e,amount:n,relays:r,comment:o=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let i={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&i.tags.push(["e",e]),i}function ua(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!nt(e))return"Zap request is not a valid Nostr event.";if(!he(e))return"Invalid signature on zap request.";let n=e.tags.find(([i,s])=>i==="p"&&s);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([i,s])=>i==="e"&&s);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([i,s])=>i==="relays"&&s)?null:"Zap request doesn't have a 'relays' tag."}function da({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let o=JSON.parse(t),i=o.tags.filter(([c])=>c==="e"||c==="p"||c==="a"),s={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...i,["P",o.pubkey],["bolt11",n],["description",t]]};return e&&s.tags.push(["preimage",e]),s}var gr={};V(gr,{getToken:()=>ha,hashPayload:()=>pr,unpackEventFromToken:()=>Bo,validateEvent:()=>Po,validateEventKind:()=>Uo,validateEventMethodTag:()=>_o,validateEventPayloadTag:()=>Ro,validateEventTimestamp:()=>To,validateEventUrlTag:()=>So,validateToken:()=>pa});var Ao="Nostr ";async function ha(t,e,n,r=!1,o){let i={kind:Nt,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&i.tags.push(["payload",pr(o)]);let s=await n(i);return(r?Ao:"")+fe.encode(te.encode(JSON.stringify(s)))}async function pa(t,e,n){let r=await Bo(t).catch(i=>{throw i});return await Po(r,e,n).catch(i=>{throw i})}async function Bo(t){if(!t)throw new Error("Missing token");t=t.replace(Ao,"");let e=ie.decode(fe.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function To(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function Uo(t){return t.kind===Nt}function So(t,e){let n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function _o(t,e){let n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function pr(t){let e=ke(te.encode(JSON.stringify(t)));return Z(e)}function Ro(t,e){let n=t.tags.find(o=>o[0]==="payload");if(!n)return!1;let r=pr(e);return n.length>0&&n[1]===r}async function Po(t,e,n,r){if(!he(t))throw new Error("Invalid nostr event, signature invalid");if(!Uo(t))throw new Error("Invalid nostr event, kind invalid");if(!To(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!So(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!_o(t,n))throw new Error("Invalid nostr event, method tag invalid");if(Boolean(r)&&typeof r=="object"&&Object.keys(r).length>0&&!Ro(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}return Co(ga);})();
